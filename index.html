<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>FitSnacks</title>
  <meta name="theme-color" content="#0b0b0d">
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root { --bg:#0b0b0d; --text:#e9e9e9; --muted:#cfcfd6; --accent:#6ea8fe; --glass:rgba(30,30,36,.55); --line:rgba(255,255,255,.08); }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px system-ui,-apple-system,Segoe UI,Roboto,sans-serif;display:flex;flex-direction:column}

    /* Header */
    header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(140%) blur(8px);background:rgba(16,16,20,.55);border-bottom:1px solid var(--line)}
    .bar{max-width:960px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:12px}
    form.search{flex:1;display:flex;align-items:center;gap:8px}
    .search input[type="search"]{
      width:100%; padding:10px 14px; border-radius:999px; border:1px solid var(--line);
      background:var(--glass); color:var(--text); outline:none;
    }
    .search button{
      border:1px solid var(--line); background:var(--glass); color:var(--text);
      border-radius:999px; padding:10px 14px; cursor:pointer;
    }

    /* Layout */
    main{flex:1;display:flex;justify-content:center;align-items:flex-start}
    .wrap{width:100%;max-width:960px;padding:28px 16px}
    .card{background:var(--glass);border:1px solid var(--line);border-radius:14px;padding:28px;box-shadow:0 6px 24px rgba(0,0,0,.28)}
    h1{margin:0 0 8px;font-size:28px}
    p{margin:0;color:var(--muted)}
    footer{opacity:.7;text-align:center;padding:24px 8px}
  </style>
<style id="cartModalOverrides">
  /* Always start hidden */
  #cartModal{display:none !important; position:fixed; inset:0; z-index:10000; 
             align-items:center; justify-content:center; background:rgba(0,0,0,.5);}
  /* When opened */
  #cartModal.open{display:flex !important;}
  /* Panel size: a bit smaller */
  #cartModal .cart-panel{width:92vw; max-width:340px; border-radius:16px; 
    background:#121214; color:#eee; padding:20px; box-shadow:0 10px 40px rgba(0,0,0,.35);}
  #cartModal .close-btn{float:right; padding:6px 10px; border:1px solid #333; border-radius:10px;}
</style>
</head>
<body>
  <header>
    <div class="bar">
      <!-- Search bar only (no FitSnacks text) -->
      <form class="search" role="search" aria-label="Search snacks" onsubmit="return handleSearch(event)">
        <input id="q" name="q" type="search" placeholder="Search snacks…" autocomplete="off" />
        <button type="submit" aria-label="Search" onclick="showCart()" onclick="showCart()" onclick="showCart()">CART</button>
      </form>
    </div>
  </header>

  <main>
    <div class="wrap">
      <section class="card">
        <h1>Clean start</h1>
        <p>Header now has a search bar. No brand text is shown.</p>
      </section>
    </div>
  </main>

  <footer>© 2025 FitSnacks</footer>

  <script>
    function handleSearch(e){
      e.preventDefault();
      const q = (document.getElementById('q')?.value || '').trim();
      if(!q){ alert('Type something to search.'); return false; }
      console.log('Search submitted:', q);
      // TODO: replace with real search later
      alert('Searching for: ' + q);
      return false;
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(r => console.log('SW registered:', r.scope))
          .catch(err => console.warn('SW registration failed:', err));
      });
    }
  </script>
<div id="cartModal" style="position:fixed;inset:0;display:none;z-index:9999;">
  <div onclick="hideCart()" style="position:absolute;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(2px);"></div>
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
              width:90%;max-width:420px;background:#111827;color:#fff;border-radius:16px;
              padding:24px;box-shadow:0 20px 60px rgba(0,0,0,.6);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <h2 style="margin:0;font-size:22px;">Your Cart</h2>
      <button onclick="hideCart()" style="background:transparent;border:0;color:#9ca3af;font-size:18px;">✕</button>
    </div>
    <div id="cartBody" style="color:#cbd5e1">Cart is empty</div>
  </div>
</div>
<script>function showCart(){var m=document.getElementById("cartModal"); if(m){m.style.display="block";}}
function hideCart(){var m=document.getElementById("cartModal"); if(m){m.style.display="none";}}</script>
<script>
(function(){
  function q(id){return document.getElementById(id);}
  window.showCart = function(){ var m=q("cartModal"); if(m){ m.style.display="block"; }};
  window.hideCart = function(){ var m=q("cartModal"); if(m){ m.style.display="none"; }};
  window.addEventListener("DOMContentLoaded", function(){
    // If multiple #cartModal exist, keep the first and remove the rest
    var mods = document.querySelectorAll("#cartModal");
    for (var i=1;i<mods.length;i++){ mods[i].remove(); }
    // Always start hidden
    if (mods[0]) { mods[0].style.display="none"; }
    // Close on ESC
    document.addEventListener("keydown", function(e){ if(e.key==="Escape"){ hideCart(); }});
  });
})();
</script>
<script id="cartModalFix">(function(){
  function $(s,root){return (root||document).querySelector(s);}
  function $all(s,root){return Array.from((root||document).querySelectorAll(s));}
  function modal(){return document.getElementById("cartModal");}
  window.showCart=function(){ var m=modal(); if(!m) return; m.classList.add("open"); m.style.display="flex"; };
  window.hideCart=function(){ var m=modal(); if(!m) return; m.classList.remove("open","show","visible"); m.style.display="none"; };
  window.addEventListener("DOMContentLoaded", function(){
    var mods=$all("#cartModal");
    for (var i=1;i<mods.length;i++){ mods[i].remove(); }
    var m=mods[0];
    if(!m){ return; }
    /* Strip any inline display or auto-open classes */
    m.classList.remove("open","show","visible","active");
    m.style.display="none";
    /* Overlay click to close */
    m.addEventListener("click", function(e){ if(e.target===m){ hideCart(); }});
    /* Close buttons inside */
    $all(".close-btn,[data-close]", m).forEach(function(btn){ btn.addEventListener("click", hideCart); });
    /* ESC to close */
    document.addEventListener("keydown", function(e){ if(e.key==="Escape") hideCart(); });
  });
})();</script>
</body>
</html>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const cartBtn = document.getElementById('cartBtn');
  if (cartBtn) {
    cartBtn.textContent = 'CART';
    cartBtn.setAttribute('aria-label','Open cart');
    cartBtn.addEventListener('click', function(){
      const ov = document.getElementById('cartOverlay');
      if (ov) ov.classList.add('show');
      else alert('Cart overlay not found yet');
    });
  }
});
</script>
<!-- Cart Overlay -->
<div id="cartOverlay" class="overlay" style="display:none;">
  <div class="sheet" style="background:rgba(20,20,24,.95);padding:20px;border-radius:18px;max-width:380px;margin:auto;">
    <div class="row-between" style="display:flex;justify-content:space-between;align-items:center;">
      <h3>Your Cart</h3>
      <button id="closeCart" style="background:none;border:none;color:#fff;font-size:18px;">✕</button>
    </div>
    <div id="cartContent" style="margin-top:12px;color:#c7c7cc;">Cart is empty</div>
  </div>
</div>

<script>
document.querySelector('#cartBtn')?.addEventListener('click',()=>{
  document.querySelector('#cartOverlay').style.display='flex';
});
document.querySelector('#closeCart')?.addEventListener('click',()=>{
  document.querySelector('#cartOverlay').style.display='none';
});
</script>
<!-- CART-INDEPENDENT-BUTTON v1 -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Prevent search form submits from hijacking clicks
  const searchForm = document.querySelector('header form, .header form, form#searchForm');
  if (searchForm) searchForm.addEventListener('submit', e => e.preventDefault());

  const searchInput = document.querySelector('#search, input[type="search"]');
  if (searchInput) {
    searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') e.preventDefault(); });
  }

  // Ensure a standalone CART button exists and is NOT a submit
  let cartBtn = document.querySelector('#cartBtn');
  if (!cartBtn) {
    cartBtn = document.createElement('button');
    cartBtn.id = 'cartBtn';
    cartBtn.type = 'button';
    cartBtn.textContent = 'CART';
    cartBtn.style.cssText = 'margin-left:8px;padding:8px 12px;border-radius:10px;border:1px solid #2a2a30;background:#18181d;color:#fff;cursor:pointer;';
    // Try to place it next to the search input; otherwise put it in header
    const target = (searchInput && searchInput.parentElement) || document.querySelector('header, .header') || document.body;
    target.appendChild(cartBtn);
  } else {
    cartBtn.type = 'button'; // force non-submit behavior
    if (!cartBtn.textContent.trim()) cartBtn.textContent = 'CART';
  }

  // Wire open/close
  const overlay = document.querySelector('#cartOverlay');
  cartBtn.addEventListener('click', () => { if (overlay) overlay.style.display = 'flex'; });
  document.querySelector('#closeCart')?.addEventListener('click', () => { if (overlay) overlay.style.display = 'none'; });

  // Close overlay when clicking backdrop
  overlay?.addEventListener('click', (e) => { if (e.target === overlay) overlay.style.display = 'none'; });
});
</script>
<!-- CART-UNLINK-HARDEN -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // 1) Find an existing CART element (by id or text) or create one
  let btn = document.querySelector('#cartBtn');
  if (!btn) {
    // try to find a button that says CART
    btn = Array.from(document.querySelectorAll('button, a')).find(el => (el.textContent||'').trim().toUpperCase() === 'CART');
  }
  if (!btn) {
    // create one and put it near the search input or header
    const host = document.querySelector('header, .header') || document.body;
    btn = document.createElement('button');
    btn.textContent = 'CART';
    host.appendChild(btn);
  }

  // 2) Replace the node to strip ALL existing listeners/classes/datasets from old code
  const clean = btn.cloneNode(true);
  clean.id = 'cartBtn';
  clean.textContent = 'CART';
  clean.type = 'button';                       // never submit a form
  clean.className = 'cart-btn';                // drop any search-related classes
  clean.removeAttribute('href');
  clean.removeAttribute('data-*');
  clean.setAttribute('aria-label','Open cart');
  // basic styling if needed
  if (!clean.style || !clean.style.padding) {
    clean.style.cssText = 'margin-left:8px;padding:8px 12px;border-radius:10px;border:1px solid #2a2a30;background:#18181d;color:#fff;cursor:pointer;';
  }
  btn.replaceWith(clean);

  // 3) Make sure CART is not inside a search <form>. If it is, move it right after the form.
  const form = clean.closest('form');
  if (form) form.after(clean);

  // 4) Kill any bubbling that search code might rely on
  clean.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation();
    const overlay = document.querySelector('#cartOverlay');
    if (overlay) overlay.style.display = 'flex';
  });

  // 5) Close behavior (X button & backdrop)
  const overlay = document.querySelector('#cartOverlay');
  document.querySelector('#closeCart')?.addEventListener('click', (e) => {
    e.preventDefault();
    overlay && (overlay.style.display = 'none');
  });
  overlay?.addEventListener('click', (e) => {
    if (e.target === overlay) overlay.style.display = 'none';
  });

  // 6) Optional: disable search form default submit so Enter doesn’t reload
  const searchForm = document.querySelector('header form, .header form, form#searchForm');
  if (searchForm) searchForm.addEventListener('submit', (e) => e.preventDefault());
});
</script>
<!-- === CART MINI-PANEL (standalone) === -->
<style>
  #cartPanel{position:fixed;right:12px;top:64px;width:88%;max-width:420px;background:#111;border:1px solid #2a2a2e;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.45);padding:16px;display:none;z-index:10000}
  #cartPanel.show{display:block}
  #cartPanel h3{margin:0 0 8px;font-size:18px}
  #cartPanel .row{display:flex;justify-content:space-between;align-items:center;gap:12px}
  #cartClose{appearance:none;border:0;background:#222;padding:8px 12px;border-radius:12px}
  #cartEmpty{opacity:.7}
</style>

<div id="cartPanel" role="dialog" aria-label="Cart panel">
  <div class="row">
    <h3>Your cart</h3>
    <button id="cartClose">Close</button>
  </div>
  <p id="cartEmpty">Cart is empty.</p>
</div>

<script>
(function(){
  // Find the CART button by its label, then give it an id and its own handler.
  function findCartBtn(){
    const els = Array.from(document.querySelectorAll('button, .btn, [role="button"]'));
    return els.find(el => (el.textContent || '').trim().toUpperCase() === 'CART');
  }
  function openCart(e){
    if(e){ e.preventDefault(); e.stopPropagation(); }
    document.getElementById('cartPanel').classList.add('show');
  }

  const cartBtn = findCartBtn();
  if (cartBtn){
    cartBtn.id = 'cartBtn';
    cartBtn.setAttribute('aria-controls','cartPanel');
    // Use capture + stopPropagation so any header/search delegation won't fire.
    cartBtn.addEventListener('click', openCart, true);
  }

  // Close button
  document.getElementById('cartClose').addEventListener('click', function(e){
    e.preventDefault();
    document.getElementById('cartPanel').classList.remove('show');
  });

  // Clicks anywhere else close the panel but ignore clicks inside the panel or on CART.
  document.addEventListener('click', function(ev){
    const t = ev.target;
    if (t && (t.id === 'cartBtn' || t.closest('#cartPanel'))) return;
    document.getElementById('cartPanel').classList.remove('show');
  }, true);
})();
</script>
<!-- === /CART MINI-PANEL === -->
<!-- === UPDATE CART STYLES: CENTERED MODAL === -->
<style>
  #cartPanel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 92%;
    max-width: 460px;
    background: #111;
    border: 1px solid #2a2a2e;
    border-radius: 20px;
    box-shadow: 0 25px 60px rgba(0,0,0,.6);
    padding: 24px;
    display: none;
    z-index: 10000;
    animation: fadeIn .25s ease;
  }
  #cartPanel.show {
    display: block;
  }
  #cartPanel h3 {
    margin: 0 0 12px;
    font-size: 20px;
    text-align: center;
  }
  #cartClose {
    appearance: none;
    border: 0;
    background: #222;
    color: #fff;
    padding: 8px 18px;
    border-radius: 12px;
    display: block;
    margin: 16px auto 0;
  }
  #cartEmpty {
    opacity: .8;
    text-align: center;
    margin-top: 20px;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -46%); }
    to { opacity: 1; transform: translate(-50%, -50%); }
  }
</style>
<!-- === /UPDATE CART STYLES === -->
<!-- CART MODAL OVERRIDES -->
<style>
  /* Target multiple possibilities just in case the id/class differs */
  #cartPanel,
  .cart-panel,
  [data-cart-panel] {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;

    width: 92% !important;
    max-width: 480px !important;
    background: #111 !important;
    border: 1px solid #2a2a2e !important;
    border-radius: 20px !important;
    box-shadow: 0 25px 60px rgba(0,0,0,.6) !important;
    padding: 24px !important;
    z-index: 10000 !important;

    /* Kill any previous bottom/right/inset rules */
    bottom: auto !important;
    right: auto !important;
    inset: auto !important;
  }

  #cartPanel h3,
  .cart-panel h3,
  [data-cart-panel] h3 {
    margin: 0 0 12px !important;
    font-size: 20px !important;
    text-align: center !important;
  }

  #cartEmpty,
  .cart-empty,
  [data-cart-empty] {
    opacity: .8 !important;
    text-align: center !important;
    margin-top: 20px !important;
  }
</style>
<!-- /CART MODAL OVERRIDES -->
<!-- Force CART modal to enlarge + center -->
<style>
  #cartPanel,
  .cart-panel,
  [data-cart-panel] {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    width: 90% !important;
    max-width: 500px !important;
    height: auto !important;
    min-height: 280px !important;
    background: #111 !important;
    border-radius: 22px !important;
    padding: 30px !important;
    z-index: 9999 !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    align-items: center !important;
    box-shadow: 0 20px 50px rgba(0,0,0,.7) !important;
  }

  #cartPanel h3,
  .cart-panel h3,
  [data-cart-panel] h3 {
    font-size: 22px !important;
    margin-bottom: 15px !important;
  }
</style>

<script>
  // Force real-time centering when opened
  document.addEventListener("DOMContentLoaded", () => {
    const cart = document.querySelector("#cartPanel, .cart-panel, [data-cart-panel]");
    if (cart) {
      const observer = new MutationObserver(() => {
        cart.style.top = "50%";
        cart.style.left = "50%";
        cart.style.transform = "translate(-50%, -50%)";
      });
      observer.observe(cart, { attributes: true, attributeFilter: ["style"] });
    }
  });
</script>
<!-- /Force CART modal to enlarge + center -->
<style>
.cart-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(30, 30, 35, 0.95);
  color: white;
  padding: 20px 30px;
  border-radius: 18px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  width: 80%;
  max-width: 400px;
  text-align: center;
  z-index: 9999;
  display: none;
}
.cart-modal.active {
  display: block;
}
</style>
<!-- v:cart-fix-4 -->
<style>
#cartDialog{
  position:fixed !important;
  top:50% !important;
  left:50% !important;
  transform:translate(-50%,-50%) !important;
  width:clamp(320px,60vw,420px) !important;
  max-height:60vh !important;
  border-radius:16px !important;
  z-index:1000 !important;
}
#cartBackdrop{
  position:fixed !important;
  inset:0 !important;
  background:rgba(0,0,0,.55) !important;
  backdrop-filter:blur(2px) !important;
  z-index:999 !important;
}
</style>
<!-- v:cart-fix-5 -->
<style>
  /* Resize + center the REAL cart dialog */
  #cartDialog{
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%,-50%) !important;
    width: clamp(320px, 55vw, 420px) !important;  /* a bit smaller */
    max-height: 55vh !important;                  /* a bit smaller */
    border-radius: 16px !important;
    z-index: 1000 !important;
  }
  #cartBackdrop{
    position: fixed !important;
    inset: 0 !important;
    background: rgba(0,0,0,.55) !important;
    backdrop-filter: blur(2px) !important;
    z-index: 999 !important;
  }
</style>

<script>
/* Kill any legacy cart UIs and stop auto-open */
(function(){
  const keep = new Set(['cartDialog','cartBackdrop','cartBtn','cartClose']);
  // Hide any old cart elements that might be stuck on screen
  document.querySelectorAll('[id*="cart"]').forEach(el=>{
    if(!keep.has(el.id)) el.style.display = 'none';
  });
  // Ensure our real cart is hidden by default
  const dialog = document.getElementById('cartDialog');
  const backdrop = document.getElementById('cartBackdrop');
  if (dialog) dialog.hidden = true;
  if (backdrop) backdrop.hidden = true;

  // Remove ANY accidental auto-open calls that might have slipped in
  // (If some inline script called openCart(), this prevents it from running again)
  window.openCart = window.openCart || function(){ 
    if (!dialog || !backdrop) return;
    backdrop.hidden = false; dialog.hidden = false; document.body.style.overflow = 'hidden';
  };
  window.closeCart = window.closeCart || function(){
    if (!dialog || !backdrop) return;
    dialog.hidden = true; backdrop.hidden = true; document.body.style.overflow = '';
  };
})();
</script>
<!-- v:cart-fix-6 -->
<style>
  /* Always hide any element marked hidden */
  [hidden]{display:none !important;}

  /* Nuke any legacy cart dialogs, keep only our #cartDialog visible */
  .cart-dialog:not(#cartDialog), .cart-modal:not(#cartDialog) { display:none !important; }

  /* Resize + center our real cart */
  #cartDialog{
    position:fixed !important;
    top:50% !important; left:50% !important; transform:translate(-50%,-50%) !important;
    width: clamp(320px, 52vw, 420px) !important;
    max-height: 55vh !important;
    border-radius:16px !important; z-index:1000 !important;
  }
  #cartBackdrop{
    position:fixed !important; inset:0 !important;
    background:rgba(0,0,0,.55) !important; backdrop-filter:blur(2px) !important;
    z-index:999 !important;
  }
</style>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const dialog   = $('#cartDialog');
  const backdrop = $('#cartBackdrop');
  const cartBtn  = $('#cartBtn');
  const closeBtn = $('#cartClose');

  // 1) Hide ANY stray/legacy cart UIs
  document.querySelectorAll('[id*="cart"], .cart-dialog, .cart-modal, .modal').forEach(el=>{
    if (el !== dialog && el !== backdrop) {
      el.style.display = 'none';
      el.hidden = true;
      el.removeAttribute('open');
    }
  });

  // 2) Make sure our cart starts hidden and is closable
  function openCart(){ if(!dialog||!backdrop) return;
    backdrop.hidden=false; dialog.hidden=false; document.body.style.overflow='hidden';
  }
  function closeCart(){ if(!dialog||!backdrop) return;
    dialog.hidden=true; backdrop.hidden=true; document.body.style.overflow='';
  }
  window.openCart = openCart; window.closeCart = closeCart;

  // wire buttons (overwrite any previous handlers)
  if (cartBtn)  cartBtn.onclick  = openCart;
  if (closeBtn) closeBtn.onclick = closeCart;
  if (backdrop) backdrop.onclick = closeCart;
  window.addEventListener('keydown', e => { if (e.key === 'Escape') closeCart(); });

  // 3) Kill any accidental auto-open that may have been left in earlier scripts
  setTimeout(closeCart, 10);
})();
</script>
